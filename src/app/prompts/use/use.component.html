<div class="p-2 max-h-full text-sm">
  <div *ngIf="prompt">
    <div class="text-2xl">{{prompt.name}}</div>
    <div class="text-md text-gray-500">{{prompt.description}}</div>
  </div>

  <div class="flex flex-col gap-5 h-full mt-2">
    <div class="g-card shadow flex flex-row justify-center">
      <form *ngIf="usePromptForms" class="md:w-1/2 w-full"
            [formGroup]="usePromptForms" (ngSubmit)="startEngine()">
        <div class="whitespace-pre-wrap" [innerHTML]="preview"></div>

        <div class="mt-2">
          <mat-divider></mat-divider>
        </div>

        <div class="flex flex-col mt-5">
          <ng-container *ngFor="let variable of usePromptForms.controls.variables?.controls">
<!--            NORMAL TEXT-->
            <mat-form-field  *ngIf="variable.controls.type.value == 'text'" appearance="outline">
              <mat-label>{{variable.controls.key.value}}</mat-label>
              <input matInput [formControl]="variable.controls.value">
            </mat-form-field>
<!--            TEXT AREA-->
            <mat-form-field appearance="outline" *ngIf="variable.controls.type.value == 'longText'">
              <mat-label>{{variable.controls.key.value}}</mat-label>
              <textarea matInput rows="5" [formControl]="variable.controls.value" class="outline-none focus:ring-0 focus-visible:ring-0"></textarea>
            </mat-form-field>
          </ng-container>

        </div>

        <div class="flex w-full justify-center">
          <button [disabled]="!userService.userAuthenticated" class="rounded inline-flex items-center bg-indigo-500 px-2 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:bg-gray-500">
            <mat-icon>psychology</mat-icon>
            <span class="mx-1" i18n>Run It</span>
          </button>
        </div>

      </form>

    </div>


    <div class="border-dashed border-2 border-gray-300 rounded-md flex items-center">
      <div class="w-full h-full" *ngIf="isSessionInitialized; else noResult">
        <app-chat></app-chat>
      </div>
    </div>
  </div>


  <ng-template #noResult>
    <div class="w-full justify-center text-gray-300 font-bold text-xl h-64 flex items-center">
      <ng-container *ngIf="userService.userAuthenticated" i18n>
        Run the prompt to see output
      </ng-container>
      <ng-container *ngIf="!userService.userAuthenticated" i18n>
        Log in to launch this prompt
      </ng-container>
    </div>
  </ng-template>
</div>
